<!doctype html><html lang=en><head><meta http-equiv=refresh content="0; url=https://forge.rust-lang.org/compiler/index.html"></head><body><input type=checkbox style=display:none id=menu-control><main class="flex container"><aside class="book-menu fixed"><nav><h2 class=book-brand><a href=https://rust-lang.github.io/compiler-team/>Rust Lang - Compiler Team</a></h2><style>nav ul a[href$=\2f compiler-team\2fprocedures\2f crates\2f ]{color:#004ed0}</style><ul><li><p><strong>About</strong></p><ul><li><a href=/compiler-team/about/CODE_OF_CONDUCT/>Code of Conduct</a></li><li><a href=/compiler-team/about/chat-platform/>Chat Platform</a></li><li><a href=/compiler-team/about/steering-meeting/>Steering Meeting</a></li><li><a href=/compiler-team/about/triage-meeting/>Triage Meeting</a></li></ul></li><li><p><strong>Minutes</strong></p><ul><li><a href=/compiler-team/minutes/design-meeting/>Design Meetings</a></li><li><a href=/compiler-team/minutes/steering-meeting/>Steering Meetings</a></li><li><a href=/compiler-team/minutes/triage-meeting/>Triage Meetings</a></li></ul></li><li><p><strong>Procedures</strong></p><ul><li><a href=/compiler-team/procedures/>Documentation</a></li><li><a href=/compiler-team/procedures/crates/>Crates</a></li><li><a href=/compiler-team/procedures/call-for-participation/>Call for participation</a></li><li><a href=/compiler-team/procedures/form-new-working-group/>Form new working group</a></li></ul></li><li><p><a href=/compiler-team/working-groups/><strong>Working Groups</strong></a></p><ul><li><a href=/compiler-team/working-groups/async-await/>Async Await</a></li><li><a href=/compiler-team/working-groups/debugging/>Debugging</a></li><li><a href=/compiler-team/working-groups/diagnostics/>Diagnostics</a></li><li><a href=/compiler-team/working-groups/rustc-dev-guide/>Rustc Dev Guide</a></li><li><a href=/compiler-team/working-groups/llvm/>LLVM</a></li><li><a href=/compiler-team/working-groups/meta/>Meta</a></li><li><a href=/compiler-team/working-groups/mir-opt/>MIR-opt</a></li><li><a href=/compiler-team/working-groups/nll/>NLL</a></li><li><a href=/compiler-team/working-groups/parallel-rustc/>parallel rustc</a></li><li><a href=/compiler-team/working-groups/pgo/>PGO</a></li><li><a href=/compiler-team/working-groups/pipelining/>pipelining</a></li><li><a href=/compiler-team/working-groups/polonius/>polonius</a></li><li><a href=/compiler-team/working-groups/polymorphization/>polymorphization</a></li><li><a href=/compiler-team/working-groups/prioritization/>Prioritization</a></li><li><a href=/compiler-team/working-groups/rfc-2229/>rfc-2229</a></li><li><a href=/compiler-team/working-groups/rls-2.0/>rls-2.0</a></li><li><a href=/compiler-team/working-groups/self-profile/>Self Profile</a></li><li><a href=/compiler-team/working-groups/traits/>Traits</a></li></ul></li></ul></nav></aside><div class=book-page><header class="align-center justify-between book-header"><label for=menu-control><img src=/compiler-team/svg/menu.svg alt=Menu>
</label><strong>Third Party out of tree crates</strong></header><article class=markdown><h1 id=third-party-and-out-of-tree-crates>Third-party and out-of-tree crates</h1><p>This document describe the guidelines for creating out-of-tree crates for use in the compiler and
using third-party crates within the compiler. These guidelines were originally discussed at the
Rust All Hands 2019 by the compiler team and others; and then at the
<a href=../../minutes/steering-meeting/2019-03-01/>01/03/2019 steering meeting</a>.</p><h2 id=out-of-tree-crates>Out-of-tree crates</h2><p>One of the primary goals of this policy is to ensure that there is consistency in how out-of-tree
crates used in the compiler are set up (at least, those maintained by the compiler team and living
in <code>rust-lang</code>) and that the experience is uniform across <code>rust-lang/rust</code> and these crates.</p><h3 id=when-should-parts-of-the-compiler-be-extracted-into-an-out-of-tree-crate>When should parts of the compiler be extracted into an out-of-tree crate?</h3><p>This is left to the discretion of compiler team members but should be discussed with the rest of
the team, either through raising the question at the weekly triage meeting or asynchronously using
an FCP in an issue. If the crate is a product of a working group, there should already be agreement
within the working group that an out-of-tree crate is suitable.</p><p>When considering creating an out-of-tree crate, it is worth balancing how general the crate should
be with the increased maintenance burden that this may bring if widely used.</p><h3 id=where-should-compiler-crates-live>Where should compiler crates live?</h3><p>Out-of-tree compiler crates should be hosted in the <code>rust-lang</code> organization - this simplifies
integration with external infrastructure tooling and will inherit existing team permissions on
GitHub. It should be made clear in any documentation that the compiler team and any appropriate
working groups are responsible for the crate. It is not recommended to start with a prototype in
another organization or personal repository.</p><h3 id=can-existing-out-of-tree-crates-from-personal-accounts-or-other-organizations-be-transferred>Can existing out-of-tree crates from personal accounts or other organizations be transferred?</h3><p>Yes, this is encouraged. In order to do this, discuss this with the team and familiarize yourself
with <a href=https://help.github.com/en/articles/transferring-a-repository>the GitHub documentation for repository transfers</a> and then arrange to perform
the transfer. Once a transfer is complete, a redirect will exist in the original account or
organization and this will conflict with the names of any new forks of the transferred repository -
an email to GitHub is required to resolve this.</p><h3 id=who-owns-these-crates>Who owns these crates?</h3><p>It is desired that a compiler team member or working group has loose ownership over a crate so
that there are clear owners who are responsible for making sure that new versions are published and
that pull requests are reviewed.</p><h3 id=what-should-these-crates-be-named>What should these crates be named?</h3><p>Crate naming will be discussed when new out-of-tree crates are proposed to the compiler team.</p><p>Crate naming will differ on a case-by-case basis. Crates that are inherently tied to the
compiler would benefit from a name that is prefixed with <code>rustc_</code>. This is an indicator of how
stable the crate may be to prospective users. Other crates, which are more general-purpose, will
have names that are disentangled from the compiler.</p><h3 id=are-there-any-limitations-on-the-review-policy-for-out-of-tree-crates>Are there any limitations on the review policy for out-of-tree crates?</h3><p>Generally, the working groups and team members that are primarily free to maintain the crate using
whatever practices are best suited to their group, however, there are some limitations so that there
is some uniformity across the compiler and out-of-tree crates:</p><ul><li>Everyone with r+ on <code>rust-lang/rust</code> should be able to review and approve PRs.</li><li>Where possible, only active participants in the crate (or related working group) need be on the
highfive rotation for the crate.</li><li>It is fine to have additional reviewers on the crate who do not otherwise have r+ for Rust as a
whole, if those reviewers are actively involved in the working group or crate maintenance.</li><li>Major pull requests should have multiple reviewers.</li></ul><h3 id=what-is-required-of-an-out-of-tree-crate>What is required of an out-of-tree crate?</h3><p>It is required that out-of-tree crates must:</p><ul><li>Be dual-licensed with Apache 2.0 and MIT when maintained by the compiler team (as the compiler
is) unless there is a compelling reason to do otherwise.<ul><li>If another license is desired, this must be brought up when proposing the new crate for
compiler team members to agree. Prefer <a href=https://github.com/rust-lang/rust/blob/master/src/tools/tidy/src/deps.rs#L10-L19>licenses accepted by tidy</a>, unless otherwise
required (ports of code from other projects, etc).</li></ul></li><li>Abide by Rust&rsquo;s code of conduct.</li><li>Specify that the crate is maintained by the Rust compiler team and any appropriate working groups.<ul><li>In particular, this should detail the expected level of maintenance and stability for any
prospective users.</li><li>This should also link to the working group details in this repository.</li></ul></li><li>Be added to the list at the bottom of this page.</li><li>Follow semantic versioning.</li><li>Use <code>@bors</code> and <code>@rust-highfive</code>.</li><li>Use labels that are compatible with the existing triage process. This will allow nominated issues
in your out-of-tree crate to be discussed during triage meetings.<ul><li>eg. <code>T-compiler</code>, <code>I-nominated</code> (a full list is to be decided)</li></ul></li></ul><h3 id=is-there-a-requirement-for-community-infrastructure-for-an-out-of-tree-crate>Is there a requirement for community infrastructure for an out-of-tree crate?</h3><p>There is no requirement that community infrastructure (such as Zulip servers/streams) be created for
out-of-tree crates. This may be desirable if an out-of-tree crate gains a large community of
contributors and users, but otherwise, the working group or compiler team streams should be used
initially.</p><p>Linkifiers for auto-linking to issues and PRs on the primary Rust Zulip server can be added on
request.</p><h3 id=are-there-any-recommendations-for-working-with-out-of-tree-crates>Are there any recommendations for working with out-of-tree crates?</h3><p>Recommendations for working with out-of-tree crates will be documented in the rustc-dev-guide (see
<a href=https://github.com/rust-lang/rustc-dev-guide/issues/285>rust-lang/rustc-dev-guide#285</a> for progress).</p><h3 id=how-should-stabilizationsemantic-changes-be-handled-in-out-of-tree-crates>How should stabilization/semantic changes be handled in out-of-tree crates?</h3><p>It is important to involve the language team in any changes in out-of-tree crates that would result
in stabilization or semantic changes to the language. Submodule changes in PRs to <code>rust-lang/rust</code>
should be labelled appropriately (eg. <code>relnotes</code>, <code>T-compiler</code>, <code>T-lang</code>) just as if the change
were implemented in <code>rust-lang/rust</code> directly, include a description of the changes when it is not
obvious to those unfamiliar with the compiler or the out-of-tree crate.</p><hr><p>In summary, the process for establishing an out-of-tree crate is as follows:</p><ol><li><p>Where appropriate, discuss and confirm the need within the working group for the out-of-tree
crate.</p></li><li><p>Create a PR modifying this document to include the crate in the list below. Use
<a href=https://github.com/anp/rfcbot-rs#usage><code>@rfcbot merge</code></a> to gain agreement from compiler
team members.</p></li><li><p>Create a new repository in the <code>rust-lang</code> organization.</p><ol><li><p>Navigate to <code>Settings > Collaborators & Teams</code> and add the <code>Compiler</code> team with write
privileges and <code>Assignees</code> with <code>read</code>.</p><ul><li>Individuals that are not part of the team can be added where appropriate.</li></ul></li><li><p>Add a README describing the intended purpose of the crate, which team and working group are
responsible (link to their page in this repository) and the intended level of maintenance and
stability.</p><blockquote><p>This crate is developed and maintained by the <a href=https://github.com/rust-lang/compiler-team/tree/master/procedures>Rust compiler team</a> for use within
<code>rustc</code>, in particular, it is the responsibility of the
<a href=../../working-groups/template><code>.template</code></a> working group. This crate [will have regular
breaking changes and provides no stability guarantees|is intended to remain stable and have
limited breaking changes].</p></blockquote></li><li><p>Include the <a href=https://github.com/rust-lang/rust/blob/master/LICENSE-APACHE>LICENSE-APACHE</a> and <a href=https://github.com/rust-lang/rust/blob/master/LICENSE-MIT>LICENSE-MIT</a> files from <code>rust-lang/rust</code>.</p></li><li><p>Include or link the <a href=../../about/code_of_conduct>CODE_OF_CONDUCT</a> file from <code>rust-lang/rust</code>.</p></li><li><p>Create a relevant <code>.gitignore</code> (<a href=https://gitignore.io/api/vim,rust,emacs,clion,visualstudio,visualstudiocode>here&rsquo;s a sane default</a>).</p></li><li><p>Create <code>P-high</code>, <code>P-med</code>, <code>P-low</code>, <code>I-nominated</code> and <code>T-compiler</code> labels.</p></li></ol></li><li><p>Consult with the infrastructure team to set up <code>@rust-highfive</code> and a process for
publishing under the &ldquo;The Rust Project Developers&rdquo; crates.io account.</p><ol><li>Add a basic <code>.travis.yml</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>language</span>: <span style=color:#ae81ff>rust</span>
</span></span><span style=display:flex><span><span style=color:#f92672>rust</span>:
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>stable</span>
</span></span></code></pre></div><ul><li><code>@bors</code> is not normally used for out-of-tree crates, GitHub&rsquo;s built-in merge facilities can
be used instead.</li></ul></li><li><p>Perform any initial development required before integration with rustc.</p></li><li><p>Publish initial version, following semantic versioning.</p></li><li><p>Add the crate as a dependency to the appropriate in-tree crate and start using.</p></li></ol><h2 id=third-party-crates>Third-party crates</h2><p>It is sometimes desirable to use the functionality of an existing third-party crate in the compiler.</p><h3 id=when-can-a-third-party-crate-be-added-as-a-compiler-dependency>When can a third-party crate be added as a compiler dependency?</h3><p>It is desirable that a third-party crate being included in the compiler is well-maintained and that,
where possible, a compiler team member is added as a maintainer. You should consult with the
rest of the compiler team before making this decision.</p><h3 id=what-about-third-party-dependencies-to-out-of-tree-crates>What about third-party dependencies to out-of-tree crates?</h3><p>The same policies apply to all compiler-team-maintained crates used in the compiler.</p><h2 id=list-of-out-of-tree-crates>List of out-of-tree crates</h2><p>This section contains the list of existing out-of-tree, compiler team-maintained crates:</p><ul><li><a href=https://github.com/rust-lang/chalk/><code>rust-lang/chalk</code></a></li><li><a href=https://github.com/rust-lang/polonius/><code>rust-lang/polonius</code></a></li><li><a href=https://github.com/rust-lang/measureme/><code>rust-lang/measureme</code></a></li></ul></article></div><aside class="book-toc level-6 fixed"><nav id=TableOfContents><ul><li><a href=#out-of-tree-crates>Out-of-tree crates</a><ul><li><a href=#when-should-parts-of-the-compiler-be-extracted-into-an-out-of-tree-crate>When should parts of the compiler be extracted into an out-of-tree crate?</a></li><li><a href=#where-should-compiler-crates-live>Where should compiler crates live?</a></li><li><a href=#can-existing-out-of-tree-crates-from-personal-accounts-or-other-organizations-be-transferred>Can existing out-of-tree crates from personal accounts or other organizations be transferred?</a></li><li><a href=#who-owns-these-crates>Who owns these crates?</a></li><li><a href=#what-should-these-crates-be-named>What should these crates be named?</a></li><li><a href=#are-there-any-limitations-on-the-review-policy-for-out-of-tree-crates>Are there any limitations on the review policy for out-of-tree crates?</a></li><li><a href=#what-is-required-of-an-out-of-tree-crate>What is required of an out-of-tree crate?</a></li><li><a href=#is-there-a-requirement-for-community-infrastructure-for-an-out-of-tree-crate>Is there a requirement for community infrastructure for an out-of-tree crate?</a></li><li><a href=#are-there-any-recommendations-for-working-with-out-of-tree-crates>Are there any recommendations for working with out-of-tree crates?</a></li><li><a href=#how-should-stabilizationsemantic-changes-be-handled-in-out-of-tree-crates>How should stabilization/semantic changes be handled in out-of-tree crates?</a></li></ul></li><li><a href=#third-party-crates>Third-party crates</a><ul><li><a href=#when-can-a-third-party-crate-be-added-as-a-compiler-dependency>When can a third-party crate be added as a compiler dependency?</a></li><li><a href=#what-about-third-party-dependencies-to-out-of-tree-crates>What about third-party dependencies to out-of-tree crates?</a></li></ul></li><li><a href=#list-of-out-of-tree-crates>List of out-of-tree crates</a></li></ul></nav></aside></main></body></html>