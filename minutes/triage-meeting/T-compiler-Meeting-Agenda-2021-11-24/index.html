<!doctype html><html lang=en><head><meta http-equiv=refresh content="0; url=https://forge.rust-lang.org/compiler/index.html"></head><body><input type=checkbox style=display:none id=menu-control><main class="flex container"><aside class="book-menu fixed"><nav><h2 class=book-brand><a href=https://rust-lang.github.io/compiler-team/>Rust Lang - Compiler Team</a></h2><style>nav ul a[href$=\2f compiler-team\2fminutes\2ftriage-meeting\2fT-compiler-Meeting-Agenda-2021-11-24\2f ]{color:#004ed0}</style><ul><li><p><strong>About</strong></p><ul><li><a href=/compiler-team/about/CODE_OF_CONDUCT/>Code of Conduct</a></li><li><a href=/compiler-team/about/chat-platform/>Chat Platform</a></li><li><a href=/compiler-team/about/steering-meeting/>Steering Meeting</a></li><li><a href=/compiler-team/about/triage-meeting/>Triage Meeting</a></li></ul></li><li><p><strong>Minutes</strong></p><ul><li><a href=/compiler-team/minutes/design-meeting/>Design Meetings</a></li><li><a href=/compiler-team/minutes/steering-meeting/>Steering Meetings</a></li><li><a href=/compiler-team/minutes/triage-meeting/>Triage Meetings</a></li></ul></li><li><p><strong>Procedures</strong></p><ul><li><a href=/compiler-team/procedures/>Documentation</a></li><li><a href=/compiler-team/procedures/crates/>Crates</a></li><li><a href=/compiler-team/procedures/call-for-participation/>Call for participation</a></li><li><a href=/compiler-team/procedures/form-new-working-group/>Form new working group</a></li></ul></li><li><p><a href=/compiler-team/working-groups/><strong>Working Groups</strong></a></p><ul><li><a href=/compiler-team/working-groups/async-await/>Async Await</a></li><li><a href=/compiler-team/working-groups/debugging/>Debugging</a></li><li><a href=/compiler-team/working-groups/diagnostics/>Diagnostics</a></li><li><a href=/compiler-team/working-groups/rustc-dev-guide/>Rustc Dev Guide</a></li><li><a href=/compiler-team/working-groups/llvm/>LLVM</a></li><li><a href=/compiler-team/working-groups/meta/>Meta</a></li><li><a href=/compiler-team/working-groups/mir-opt/>MIR-opt</a></li><li><a href=/compiler-team/working-groups/nll/>NLL</a></li><li><a href=/compiler-team/working-groups/parallel-rustc/>parallel rustc</a></li><li><a href=/compiler-team/working-groups/pgo/>PGO</a></li><li><a href=/compiler-team/working-groups/pipelining/>pipelining</a></li><li><a href=/compiler-team/working-groups/polonius/>polonius</a></li><li><a href=/compiler-team/working-groups/polymorphization/>polymorphization</a></li><li><a href=/compiler-team/working-groups/prioritization/>Prioritization</a></li><li><a href=/compiler-team/working-groups/rfc-2229/>rfc-2229</a></li><li><a href=/compiler-team/working-groups/rls-2.0/>rls-2.0</a></li><li><a href=/compiler-team/working-groups/self-profile/>Self Profile</a></li><li><a href=/compiler-team/working-groups/traits/>Traits</a></li></ul></li></ul></nav></aside><div class=book-page><header class="align-center justify-between book-header"><label for=menu-control><img src=/compiler-team/svg/menu.svg alt=Menu>
</label><strong>T Compiler Meeting Agenda 2021 11 24</strong></header><article class=markdown><h1 id=t-compiler-meeting-agenda-2021-11-24>T-compiler Meeting Agenda 2021-11-24</h1><p><a href=https://github.com/rust-lang/rust/issues/54818>Tracking Issue</a></p><h2 id=announcements>Announcements</h2><ul><li>:loudspeaker: next week December, 2nd, release of Rust stable 1.57</li><li>Reminder: if you see a PR/issue that seems like there might be legal implications due to copywrite/IP/etc, please let the Core team know (or at least message @<em><strong>pnkfelix</strong> or @</em><strong>Wesley Wiser</strong> so we can pass it along).</li></ul><h2 id=mcpsfcps>MCPs/FCPs</h2><ul><li>New MCPs (take a look, see if you like them!)<ul><li>&ldquo;Tier 3 target proposal: riscv64gc-linux-android (Android target for <code>riscv64gc</code>)&rdquo; <a href=https://github.com/rust-lang/compiler-team/issues/472>compiler-team#472</a></li></ul></li><li>Old MCPs (not seconded, take a look)<ul><li>&ldquo;CI should exercise (subset of) tests under &ndash;stage 1&rdquo; <a href=https://github.com/rust-lang/compiler-team/issues/439>compiler-team#439</a> (last review activity: 3 months ago)</li><li>&ldquo;Accept <code>pc</code> in place of <code>unknown</code> and <code>unknown</code> in place of <code>pc</code> for <code>x86_64</code> and <code>i?86</code> targets&rdquo; <a href=https://github.com/rust-lang/compiler-team/issues/441>compiler-team#441</a> (last review activity: 4 months ago)</li><li>&ldquo;Make <code>-Z binary-dep-depinfo</code> the default behavior&rdquo; <a href=https://github.com/rust-lang/compiler-team/issues/464>compiler-team#464</a> (last review activity: about 54 days ago)</li></ul></li><li>Pending FCP requests (check your boxes!)<ul><li>No pending FCP requests this time.</li></ul></li><li>Things in FCP (make sure you&rsquo;re good with it)<ul><li>&ldquo;Unstable lints should be considered unknown&rdquo; <a href=https://github.com/rust-lang/compiler-team/issues/469>compiler-team#469</a></li><li>&ldquo;Tracking Issue for cargo report future-incompat&rdquo; <a href=https://github.com/rust-lang/rust/issues/71249>rust#71249</a></li><li>&ldquo;Tracking Issue for inline assembly (<code>asm!</code>)&rdquo; <a href=https://github.com/rust-lang/rust/issues/72016>rust#72016</a></li></ul></li><li>Accepted MCPs<ul><li>No new accepted proposals this time.</li></ul></li><li>Finalized FCPs (disposition merge)<ul><li>No new finished FCP (disposition merge) this time.</li></ul></li></ul><h3 id=wg-checkins>WG checkins</h3><ul><li>@<em>WG-diagnostics</em> by @<strong>Esteban KÃ¼ber</strong> and @<strong>oli</strong> (<a href=https://hackmd.io/czhRhn0rSaib7Pnr5ZvDUg?view#WG-checkins>previous checkin</a>):</li></ul><blockquote><p>nothing to report at this time</p></blockquote><ul><li>@_<em>WG-rustc-dev-guide</em> by @<strong>Santiago Pastorino</strong> and @<strong>Yuki Okushi|217081</strong> (<a href=https://hackmd.io/czhRhn0rSaib7Pnr5ZvDUg?view#WG-checkins>previous checkin</a>):</li></ul><blockquote><h4 id=most-notable-changes>Most notable changes</h4><ul><li>Make subtree docs an overview and add link to clippy docs for details <a href=https://github.com/rust-lang/rustc-dev-guide/pull/1244>#1244</a></li><li>Describe drop elaboration <a href=https://github.com/rust-lang/rustc-dev-guide/pull/1240>#1240</a></li><li>Edit bootstrapping chapter <a href=https://github.com/rust-lang/rustc-dev-guide/pull/1239>#1239</a></li><li>Add documentation for LLVM CFI support <a href=https://github.com/rust-lang/rustc-dev-guide/pull/1234>#1234</a></li></ul><h4 id=most-notable-wips>Most notable WIPs</h4><ul><li>Document more compiletest headers. <a href=https://github.com/rust-lang/rustc-dev-guide/pull/1249>#1249</a></li><li>Added detail to codegen section <a href=https://github.com/rust-lang/rustc-dev-guide/pull/1216>#1216</a></li><li>Document inert vs active attributes <a href=https://github.com/rust-lang/rustc-dev-guide/pull/1110>#1110</a></li><li>Explain the new valtree system for type level constants. <a href=https://github.com/rust-lang/rustc-dev-guide/pull/1097>#1097</a></li></ul></blockquote><h2 id=backport-nominations>Backport nominations</h2><p><a href="https://github.com/rust-lang/rust/issues?q=is%3Aall+label%3Abeta-nominated+-label%3Abeta-accepted+label%3AT-compiler">T-compiler stable</a> / <a href="https://github.com/rust-lang/rust/issues?q=is%3Aall+label%3Astable-nominated+-label%3Astable-accepted+label%3AT-compiler">T-compiler beta</a></p><ul><li>:beta: &ldquo;relate lifetime in <code>TypeOutlives</code> bounds on drop impls&rdquo; <a href=https://github.com/rust-lang/rust/pull/90840>rust#90840</a><ul><li>fixes p-critical unsoundness <a href=https://github.com/rust-lang/rust/issues/90838>rust#90838</a></li><li>@<strong>pnkfelix</strong> has also produced a scope-limited backport in <a href=https://github.com/rust-lang/rust/pull/91136>rust#91136</a></li><li>@<strong>Jack Huey</strong> comments on <a href=https://github.com/rust-lang/rust/pull/91136#issuecomment-976157727>rust#91136</a> on which of the two is better suited for a backport</li></ul></li><li>:stable: &ldquo;relate lifetime in <code>TypeOutlives</code> bounds on drop impls&rdquo; <a href=https://github.com/rust-lang/rust/pull/90840>rust#90840</a><ul><li>see beta nomination</li></ul></li></ul><p><a href="https://github.com/rust-lang/rust/issues?q=is%3Aall+label%3Abeta-nominated+-label%3Abeta-accepted+label%3AT-rustdoc">T-rustdoc stable</a> / <a href="https://github.com/rust-lang/rust/issues?q=is%3Aall+label%3Astable-nominated+-label%3Astable-accepted+label%3AT-rustdoc">T-rustdoc beta</a></p><ul><li>No beta nominations for <code>T-rustdoc</code> this time.</li><li>No stable nominations for <code>T-rustdoc</code> this time.</li></ul><p>:back: / :shrug: / :hand:</p><h2 id=prs-s-waiting-on-team>PRs S-waiting-on-team</h2><p><a href="https://github.com/rust-lang/rust/pulls?utf8=%E2%9C%93&amp;q=is%3Aopen+label%3AS-waiting-on-team+label%3AT-compiler">T-compiler</a></p><ul><li>No PRs waiting for T-compiler</li></ul><h2 id=oldest-prs-waiting-for-review>Oldest PRs waiting for review</h2><p><a href="https://github.com/rust-lang/rust/pulls?q=is%3Apr+is%3Aopen+sort%3Aupdated-asc+label%3AS-waiting-on-review+draft%3Afalse+label%3AT-compiler">T-compiler</a></p><ul><li>&ldquo;Add long explanation for E0726&rdquo; <a href=https://github.com/rust-lang/rust/pull/87655>rust#87655</a> (last review activity: 3 months ago)</li><li>&ldquo;Lint bare traits in AstConv.&rdquo; <a href=https://github.com/rust-lang/rust/pull/89090>rust#89090</a> (last review activity: about 60 days ago)</li><li>&ldquo;Introduce linter for diagnostic messages&rdquo; <a href=https://github.com/rust-lang/rust/pull/89455>rust#89455</a> (last review activity: about 49 days ago)</li><li><a href=https://github.com/rust-lang/rust/pull/90125>Fix false positive for typoed crate or module suggestion</a> (last activity: none)<ul><li>opened 1 month ago, needs a reviewer</li><li>highfive bot assigned to @<strong>Esteban KÃ¼ber</strong></li></ul></li><li><a href=https://github.com/rust-lang/rust/pull/89369>Allow use of AddressSanitizer on Windows by linking to existing libraries</a> (last activity: about 1 month ago)<ul><li>previously discussed and reassigned to @<strong>Wesley Wiser</strong> for review</li></ul></li><li><a href=https://github.com/rust-lang/rust/pull/89455>Introduce linter for diagnostic messages</a> (last activity: about 40 days ago)<ul><li>previously reviewed by @<strong>Esteban KÃ¼ber</strong> and @<strong>simulacrum</strong></li></ul></li><li>&ldquo;Support versioned dylibs&rdquo; <a href=https://github.com/rust-lang/rust/pull/90260>rust#90260</a> (last activity: 28 days ago)<ul><li>last review from @<strong>Wesley Wiser</strong>, then more comments</li><li>Is this <code>S-waiting-on-author</code>?</li></ul></li><li><a href=https://github.com/rust-lang/rust/pull/90023>Postpone the evaluation of constant expressions that depend on inference variables</a> (last activity: about 17 days ago)<ul><li>review from @<strong>lcnr</strong>, <a href=https://github.com/rust-lang/rust/pull/90023#issuecomment-953497106>left some comments</a> about merging this PR later after some more thoughts</li></ul></li></ul><h2 id=issues-of-note>Issues of Note</h2><h3 id=short-summary>Short Summary</h3><ul><li><a href="https://github.com/rust-lang/rust/issues?q=is%3Aopen+label%3AT-compiler+label%3AP-critical">4 T-compiler P-critical issues</a><ul><li><a href="https://github.com/rust-lang/rust/issues?q=is%3Aopen+label%3AT-compiler+label%3AP-critical+no%3Aassignee">2 of those are unassigned</a></li></ul></li><li><a href="https://github.com/rust-lang/rust/issues?q=is%3Aopen+label%3AT-compiler+label%3AP-high">79 T-compiler P-high issues</a><ul><li><a href="https://github.com/rust-lang/rust/issues?q=is%3Aopen+label%3AT-compiler+label%3AP-high+no%3Aassignee">55 of those are unassigned</a></li></ul></li><li><a href=https://github.com/rust-lang/rust/labels/regression-from-stable-to-beta>2 P-critical, 4 P-high, 2 P-medium, 0 P-low regression-from-stable-to-beta</a></li><li><a href=https://github.com/rust-lang/rust/labels/regression-from-stable-to-nightly>0 P-critical, 2 P-high, 2 P-medium, 1 P-low regression-from-stable-to-nightly</a></li><li><a href=https://github.com/rust-lang/rust/labels/regression-from-stable-to-stable>4 P-critical, 46 P-high, 84 P-medium, 12 P-low regression-from-stable-to-stable</a></li></ul><h3 id=p-critical>P-critical</h3><p><a href="https://github.com/rust-lang/rust/issues?utf8=%E2%9C%93&amp;q=is%3Aopen+label%3AP-critical+label%3AT-compiler">T-compiler</a></p><ul><li>&ldquo;Miscompilation where binding only some fields leaks the others&rdquo; <a href=https://github.com/rust-lang/rust/issues/90752>rust#90752</a><ul><li>Mentioned in <a href=#Nominated-Issues>I-nominated issues</a></li></ul></li><li>&ldquo;Unsound drop due to imperfect lifetime checks&rdquo; <a href=https://github.com/rust-lang/rust/issues/90838>rust#90838</a><ul><li>Has two PR fixing this: <a href=https://github.com/rust-lang/rust/pull/90840>rust#90840</a> and <a href=https://github.com/rust-lang/rust/pull/91136>rust#91136</a> from @<strong>pnkfelix</strong> (see backports)</li></ul></li><li>&ldquo;Implied bounds by associated types as function parameters are inconsistent in an unsound way.&rdquo; <a href=https://github.com/rust-lang/rust/issues/91068>rust#91068</a><ul><li>opened by @<strong>Frank Steffahn</strong>, also bisected to PR <a href=https://github.com/rust-lang/rust/pull/88312>rust#88312</a></li><li>discussion about reverting <a href=https://github.com/rust-lang/rust/issues/91068#issuecomment-975788073>rust#88312</a></li></ul></li><li>&ldquo;Huge compile-time regression in beta/nightly&rdquo; <a href=https://github.com/rust-lang/rust/issues/91128>rust#91128</a><ul><li>we have a <a href=https://github.com/rust-lang/rust/issues/91128#issuecomment-977154873>reproducible example</a></li><li>seems correlated to the new LLVM pass-manager (disabling it solves the issue)</li><li>(the new LLVM pass-manager will enter in stable and is enabled by default)</li></ul></li></ul><p><a href="https://github.com/rust-lang/rust/issues?utf8=%E2%9C%93&amp;q=is%3Aopen+label%3AP-critical+label%3AT-rustdoc">T-rustdoc</a></p><ul><li>No <code>P-critical</code> issues for <code>T-rustdoc</code> this time.</li></ul><h3 id=p-high-regressions>P-high regressions</h3><p><a href="https://github.com/rust-lang/rust/issues?q=is%3Aopen+label%3Aregression-from-stable-to-beta+label%3AP-high+-label%3AT-infra+-label%3AT-libs+-label%3AT-release+-label%3AT-rustdoc+-label%3AT-core">P-high beta regressions</a></p><ul><li>&ldquo;Compilation appears to loop indefinitely " <a href=https://github.com/rust-lang/rust/issues/89195>rust#89195</a><ul><li>discussed <a href=https://rust-lang.zulipchat.com/#narrow/stream/238009-t-compiler.2Fmeetings/topic/.5Bplanning.20meeting.5D.202021-11-19/near/262082635>last week</a><ul><li>@<strong>pnkfelix</strong> self assigned as reminder to reach out to Kyle Huey and schedule chat with @<strong>Aaron Hill</strong></li></ul></li></ul></li><li>&ldquo;regression: rustc suggests <code>.as_ref()</code> at incorrect location and other spans have regressed&rdquo; <a href=https://github.com/rust-lang/rust/issues/90286>rust#90286</a><ul><li>@<strong>Esteban KÃ¼ber</strong> <a href=https://github.com/rust-lang/rust/issues/90286#issuecomment-974534925>comments wrt to a revert</a> that it would cause another bug to resurface, would try to prepare a fix before the next release</li></ul></li><li>&ldquo;DWARF info for <code>static</code> vars in lib crates has stopped being produced reliably in LTO builds&rdquo; <a href=https://github.com/rust-lang/rust/issues/90357>rust#90357</a><ul><li>bisection seems to point to <a href=https://github.com/rust-lang/rust/pull/89041>rust#89041</a> but <strong>cuviper</strong> suggests could be a dupe of <a href=https://github.com/rust-lang/rust/issues/90301>rust#90301</a> and #89041 possibly just exacerbated the LLVM issue</li><li>also reproduces on nightly</li></ul></li></ul><p><a href="https://github.com/rust-lang/rust/issues?q=is%3Aopen+label%3Aregression-from-stable-to-nightly+label%3AP-high+no%3Aassignee+-label%3AT-infra+-label%3AT-libs+-label%3AT-release+-label%3AT-rustdoc+-label%3AT-core">Unassigned P-high nightly regressions</a></p><ul><li>&ldquo;Undefined reference to <code>getauxval</code> in function <code>init_have_lse_atomics</code> when compiling to nightly <code>aarch64-unknown-linux-musl</code>&rdquo; <a href=https://github.com/rust-lang/rust/issues/89626>rust#89626</a><ul><li>Seems that it now <a href=https://github.com/rust-lang/rust/issues/89626#issuecomment-976374296>happens also on beta</a>, which will become stable in a week</li><li>@<strong>Hans Kratz</strong> suggest <a href=https://github.com/rust-lang/rust/issues/89626#issuecomment-946434059>as a workaround</a></li><li><a href=https://rust-lang.zulipchat.com/#narrow/stream/238009-t-compiler.2Fmeetings/topic/.5Bweekly.5D.202021-11-04.20.2354818/near/260281814>discussed previously</a></li><li><a href=https://github.com/rust-lang/rust/issues/89626#issuecomment-975942202>as a workaround</a> <code>-Clinker=rust-lld</code> works</li><li>Issue should be fixed by <a href=https://github.com/rust-lang/rust/pull/90527>rust#90527</a> + <a href=https://github.com/rust-lang/libc/pull/2272>libc#2272</a> as soon as the fixed libc 0.2.107 is merged, see <a href=https://github.com/rust-lang/rust/issues/90681>rust#90681</a></li></ul></li></ul><h2 id=performance-logs>Performance logs</h2><blockquote><p><a href=https://github.com/rust-lang/rustc-perf/blob/master/triage/2021-11-23.md>triage logs 2021-11-23</a></p></blockquote><p>This week, there were a number of cases where the <code>incr-unchanged</code> variants of <code>inflate</code> went up or down by 5% to 6%; we believe these are instances of increased noise in benchmarks documented on <a href=https://github.com/rust-lang/rustc-perf/issues/1105>rustc-perf#1105</a>. I was tempted to remove these from the report, but its non-trivial to re-construct the report &ldquo;as if&rdquo; some benchmark were omitted.</p><p>Otherwise, there were some nice wins for performance. For example, PR <a href=https://github.com/rust-lang/rust/issues/90996>#90996</a> more than halved the compilation time for <code>full</code> builds of <code>diesel</code> by revising how we hash <code>ObligationCauseData</code>. If anyone is interested, it might be good to follow-up on the effects of PR <a href=https://github.com/rust-lang/rust/issues/90352>#90352</a>, &ldquo;Simplify <code>for</code> loop desugar&rdquo;, where we have hypothesized that the increased compilation time is due to more LLVM optimizations being applied.</p><p>Triage done by <strong>@pnkfelix</strong>.
Revision range: <a href="https://perf.rust-lang.org/?start=934624fe5f66ce3fb8abf0597a6deb079783335f&amp;end=22c2d9ddbf356bcdb718e88ca6ee3665e1e42690&amp;absolute=false&amp;stat=instructions%3Au">934624fe..22c2d9dd</a></p><p>1 Regressions, 3 Improvements, 8 Mixed; 3 of them in rollups, 30 Untriaged PRs
34 comparisons made in total</p><h4 id=regressions>Regressions</h4><p>rustdoc: Make two small cleanups <a href=https://github.com/rust-lang/rust/issues/91073>#91073</a></p><ul><li>Very large regression in <a href="https://perf.rust-lang.org/compare.html?start=5bc98076f37dd8c1476de4bbe0515c55a65332b7&amp;end=02913c078849f940371eb9930754f2b0f1bc9fad&amp;stat=instructions:u">instruction counts</a> (up to 5.3% on <code>incr-unchanged</code> builds of <code>inflate</code>)</li><li>This was <a href=https://github.com/rust-lang/rust/pull/91073#issuecomment-974880869>previously triaged</a> as spurious by the PR author.</li><li>(<em>Only</em> inflate debug incr-unchanged was affected significantly.)</li></ul><h4 id=improvements>Improvements</h4><ul><li>Rollup of 7 pull requests <a href=https://github.com/rust-lang/rust/issues/90966>#90966</a></li><li>Optimize <code>impl Hash for ObligationCauseData</code> by not hashing <code>ObligationCauseCode</code> variant fields <a href=https://github.com/rust-lang/rust/issues/90996>#90996</a></li><li>Avoid documenting top-level private imports <a href=https://github.com/rust-lang/rust/issues/91094>#91094</a></li><li>rustdoc: Cleanup <code>DocFragment</code> <a href=https://github.com/rust-lang/rust/issues/91034>#91034</a></li><li>libcore: assume the input of <code>next_code_point</code> and <code>next_code_point_reverse</code> is UTF-8-like <a href=https://github.com/rust-lang/rust/issues/89611>#89611</a></li></ul><h4 id=mixed>Mixed</h4><p>Remove <code>DropArena</code>. <a href=https://github.com/rust-lang/rust/issues/90919>#90919</a></p><ul><li>Small improvement in <a href="https://perf.rust-lang.org/compare.html?start=934624fe5f66ce3fb8abf0597a6deb079783335f&amp;end=d914f17ca71a33a89b2dc3436fca51b1a091559e&amp;stat=instructions:u">instruction counts</a> (up to -0.3% on <code>incr-patched: println</code> builds of <code>clap-rs</code>)</li><li>Very large regression in <a href="https://perf.rust-lang.org/compare.html?start=934624fe5f66ce3fb8abf0597a6deb079783335f&amp;end=d914f17ca71a33a89b2dc3436fca51b1a091559e&amp;stat=instructions:u">instruction counts</a> (up to 6.1% on <code>incr-unchanged</code> builds of <code>inflate</code>)</li><li>This was triaged as noise in the PR comments both <a href=https://github.com/rust-lang/rust/pull/90919/#issuecomment-968772257>before it landed</a> and <a href=https://github.com/rust-lang/rust/pull/90919/#issuecomment-970656929>after it landed</a>.</li></ul><p>std: Get the standard library compiling for wasm64 <a href=https://github.com/rust-lang/rust/issues/90382>#90382</a></p><ul><li>Large improvement in <a href="https://perf.rust-lang.org/compare.html?start=6414e0b5b308d3ae27da83c6a25098cc8aadc1a9&amp;end=b6f580acc0ce233d5c4d1f9680d354fded88b824&amp;stat=instructions:u">instruction counts</a> (up to -4.3% on <code>incr-unchanged</code> builds of <code>clap-rs</code>)</li><li>Moderate regression in <a href="https://perf.rust-lang.org/compare.html?start=6414e0b5b308d3ae27da83c6a25098cc8aadc1a9&amp;end=b6f580acc0ce233d5c4d1f9680d354fded88b824&amp;stat=instructions:u">instruction counts</a> (up to 1.0% on <code>incr-unchanged</code> builds of <code>issue-88862</code>)</li><li>There were a lot of various changes in this PR, such as updates to dependencies (<code>compiler_builtins</code> and <code>dlmalloc</code>). We probably shoud have done a pre-merge rust-timer run on this PR.</li><li>The flagged regressions of magnitude greater than 0.5% are isolated to &ldquo;issue-88862 check&rdquo; and &ldquo;style-servo check&rdquo;. The improvements tended to outweigh the regressions. For the most part almost all significant performance effects are isolated to check builds.</li></ul><p>Rollup of 8 pull requests <a href=https://github.com/rust-lang/rust/issues/91019>#91019</a></p><ul><li>Moderate improvement in <a href="https://perf.rust-lang.org/compare.html?start=b6f580acc0ce233d5c4d1f9680d354fded88b824&amp;end=cc946fcd326f7d85d4af096efdc73538622568e9&amp;stat=instructions:u">instruction counts</a> (up to -0.6% on <code>incr-unchanged</code> builds of <code>style-servo</code>)</li><li>Moderate regression in <a href="https://perf.rust-lang.org/compare.html?start=b6f580acc0ce233d5c4d1f9680d354fded88b824&amp;end=cc946fcd326f7d85d4af096efdc73538622568e9&amp;stat=instructions:u">instruction counts</a> (up to 0.8% on <code>full</code> builds of <code>await-call-tree</code>)</li><li>The regression is entirely associated with doc builds, which led to the PR author to flag PR <a href=https://github.com/rust-lang/rust/pull/90750>#90750</a> as the root cause.</li><li>It seems to me like the extra work injected by PR <a href=https://github.com/rust-lang/rust/pull/90750>#90750</a> may be unavoidable; but was it expected to be significant?</li></ul><p>Implement <code>clone_from</code> for <code>State</code> <a href=https://github.com/rust-lang/rust/issues/90535>#90535</a></p><ul><li>Small improvement in <a href="https://perf.rust-lang.org/compare.html?start=3b65165ab79f535792fc7c504b3fbadf29d7a877&amp;end=50f2c292007f9364908e4b8344886797f0144648&amp;stat=instructions:u">instruction counts</a> (up to -0.2% on <code>full</code> builds of <code>many-assoc-items</code>)</li><li>Very large regression in <a href="https://perf.rust-lang.org/compare.html?start=3b65165ab79f535792fc7c504b3fbadf29d7a877&amp;end=50f2c292007f9364908e4b8344886797f0144648&amp;stat=instructions:u">instruction counts</a> (up to 6.1% on <code>incr-unchanged</code> builds of <code>inflate</code>)</li><li>This was evaluated for its effect on performance <a href=https://github.com/rust-lang/rust/pull/90535#issuecomment-973298904>prior to merge</a>; that run returned no relevant changes.</li><li>As noted elsewhere, for this report we should probably treat &ldquo;inflate&rdquo; as noisy.</li></ul><p>Update stdarch <a href=https://github.com/rust-lang/rust/issues/91052>#91052</a></p><ul><li>Very large improvement in <a href="https://perf.rust-lang.org/compare.html?start=50f2c292007f9364908e4b8344886797f0144648&amp;end=6d48ee90f51dd5793b425c6593581fd108ead398&amp;stat=instructions:u">instruction counts</a> (up to -5.8% on <code>incr-unchanged</code> builds of <code>inflate</code>)</li><li>Small regression in <a href="https://perf.rust-lang.org/compare.html?start=50f2c292007f9364908e4b8344886797f0144648&amp;end=6d48ee90f51dd5793b425c6593581fd108ead398&amp;stat=instructions:u">instruction counts</a> (up to 0.3% on <code>incr-patched: println</code> builds of <code>html5ever</code>)</li><li>The only benchmark that regressed is &ldquo;html5ever debug&rdquo; (&ldquo;incr-patched: println&rdquo; and &ldquo;incr-unchanged&rdquo;), and only by a relatively small amount. This seems acceptable to me, compared to the effort involved in figuring out how this change could be related to that effect.</li></ul><p>Point at source of trait bound obligations in more places <a href=https://github.com/rust-lang/rust/issues/89580>#89580</a></p><ul><li>Large improvement in <a href="https://perf.rust-lang.org/compare.html?start=02913c078849f940371eb9930754f2b0f1bc9fad&amp;end=b8e5ab20ed7a7677a998a163ccf7853764b195e6&amp;stat=instructions:u">instruction counts</a> (up to -5.0% on <code>incr-unchanged</code> builds of <code>inflate</code>)</li><li>Small regression in <a href="https://perf.rust-lang.org/compare.html?start=02913c078849f940371eb9930754f2b0f1bc9fad&amp;end=b8e5ab20ed7a7677a998a163ccf7853764b195e6&amp;stat=instructions:u">instruction counts</a> (up to 1.1% on <code>incr-unchanged</code> builds of <code>wg-grammar</code>)</li><li>(Again, we can probably ignore the change to <code>inflate</code>.)</li><li>Other than that, there were a broad set of small regressions. Putting aside the ones tagged with <code>?</code> (&ldquo;noisy&rdquo;), there are 19 benchmarks that regressed by 0.10% to 0.42%. This seems like an acceptable cost.</li></ul><p>Simplify <code>for</code> loop desugar <a href=https://github.com/rust-lang/rust/issues/90352>#90352</a></p><ul><li>Very large improvement in <a href="https://perf.rust-lang.org/compare.html?start=65f3f8b220f020e562c5dd848ff7319257a7ba45&amp;end=cebd2dda1d9071f2209079370c412f4ef9ef2b82&amp;stat=instructions:u">instruction counts</a> (up to -6.2% on <code>incr-full</code> builds of <code>clap-rs</code>)</li><li>Large regression in <a href="https://perf.rust-lang.org/compare.html?start=65f3f8b220f020e562c5dd848ff7319257a7ba45&amp;end=cebd2dda1d9071f2209079370c412f4ef9ef2b82&amp;stat=instructions:u">instruction counts</a> (up to 2.3% on <code>full</code> builds of <code>regex</code>)</li><li>This was triaged in the PR comments both <a href=https://github.com/rust-lang/rust/pull/90352#issuecomment-972986518>before it landed</a> and <a href=https://github.com/rust-lang/rust/pull/90352#issuecomment-975432954>after it landed</a> with the justification &ldquo;The regressions seem to all be in <code>-opt</code> builds and solely part of the time spent in LLVM, so I&rsquo;m hoping it&rsquo;s that more optimizations apply now (and worst case some optimizations require more work but don&rsquo;t result in better code).&rdquo;</li></ul><p>Manually outline error on incremental_verify_ich <a href=https://github.com/rust-lang/rust/issues/89883>#89883</a></p><ul><li>Small improvement in <a href="https://perf.rust-lang.org/compare.html?start=7c4be43b27993ab405beaa19738258fdd546d3db&amp;end=22c2d9ddbf356bcdb718e88ca6ee3665e1e42690&amp;stat=instructions:u">instruction counts</a> (up to -0.8% on <code>incr-unchanged</code> builds of <code>clap-rs</code>)</li><li>Large regression in <a href="https://perf.rust-lang.org/compare.html?start=7c4be43b27993ab405beaa19738258fdd546d3db&amp;end=22c2d9ddbf356bcdb718e88ca6ee3665e1e42690&amp;stat=instructions:u">instruction counts</a> (up to 1.1% on <code>incr-unchanged</code> builds of <code>coercions</code>)</li><li>The <a href=https://github.com/rust-lang/rust/pull/89883#issuecomment-974927075>pre-merge rustc-timer run</a> did not predict such a significant impact on <code>coercions</code>.</li><li>The driving force for this change was to reduce the critical path in bootstrap time, so the most important thing to look at is the <a href="https://perf.rust-lang.org/compare.html?start=7c4be43b27993ab405beaa19738258fdd546d3db&amp;end=22c2d9ddbf356bcdb718e88ca6ee3665e1e42690#bootstrap">bootstrap timing data</a>. Specifically: while there is a big mix of ups and downs on the percentages column, the crate that takes the longest to compile (<code>rustc_query_impl</code>, the laggard at over 80 seconds of compilation time).</li><li>This PR brings the compilation time of <code>rustc_query_impl</code> from 87.1 seconds down to 85.6 seconds, a -1.8% improvement.</li><li>That is consistent with the <a href=https://github.com/rust-lang/rust/pull/89883#issue-758410955>predicted effect</a> of the PR, and justifies the isolated impact on instruction counts.</li></ul><h2 id=nominated-issues>Nominated Issues</h2><p><a href=https://github.com/rust-lang/rust/labels/I-compiler-nominated>T-compiler</a></p><ul><li>&ldquo;Tracking issue for plugin stabilization (<code>plugin</code>, <code>plugin_registrar</code> features)&rdquo; <a href=https://github.com/rust-lang/rust/issues/29597>rust#29597</a></li><li>&ldquo;Change <code>char</code> type in debuginfo to DW_ATE_UTF&rdquo; <a href=https://github.com/rust-lang/rust/pull/89887>rust#89887</a></li><li>&ldquo;sess: default to v0 symbol mangling&rdquo; <a href=https://github.com/rust-lang/rust/pull/89917>rust#89917</a></li><li>&ldquo;implement aspect-oriented programming (AOP) for Rust&rdquo; <a href=https://github.com/rust-lang/rust/pull/90721>rust#90721</a></li><li>&ldquo;Miscompilation where binding only some fields leaks the others&rdquo; <a href=https://github.com/rust-lang/rust/issues/90752>rust#90752</a><ul><li>@<strong>tmandry</strong> nominated</li><li><a href=https://github.com/rust-lang/rust/issues/90752#issuecomment-965822895>great writeup</a> from @<strong>Dylan MacKenzie (ecstatic-morse)</strong>, suggests a quick fix</li><li>Opened PR <a href=https://github.com/rust-lang/rust/pull/90788>rust#90788</a> that implements the quick fix suggested. PR is beiung reviewed.</li><li>wg-prio assigned <code>P-critical</code>, but being a regression from stable probably not a release blocker?</li></ul></li></ul><p><a href="https://github.com/rust-lang/rfcs/issues?q=is%3Aopen+label%3AI-nominated+label%3AT-compiler">RFC</a></p><ul><li>No nominated RFCs for <code>T-compiler</code> this time.</li></ul></article></div><aside class="book-toc level-6 fixed"><nav id=TableOfContents><ul><li><a href=#announcements>Announcements</a></li><li><a href=#mcpsfcps>MCPs/FCPs</a><ul><li><a href=#wg-checkins>WG checkins</a></li></ul></li><li><a href=#backport-nominations>Backport nominations</a></li><li><a href=#prs-s-waiting-on-team>PRs S-waiting-on-team</a></li><li><a href=#oldest-prs-waiting-for-review>Oldest PRs waiting for review</a></li><li><a href=#issues-of-note>Issues of Note</a><ul><li><a href=#short-summary>Short Summary</a></li><li><a href=#p-critical>P-critical</a></li><li><a href=#p-high-regressions>P-high regressions</a></li></ul></li><li><a href=#performance-logs>Performance logs</a><ul><li></li></ul></li><li><a href=#nominated-issues>Nominated Issues</a></li></ul></nav></aside></main></body></html>